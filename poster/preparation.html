<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="P4 Team Oldlace  Oh Jia Wei Darien (2200607)   Peter Febrianto Afandy (2200959)   Quek Joo Wee (2201046)   Desmond Loy Yong Kiat (2201435)   Rene Low Yi Xuan (2202620)   Phileo Teo Weihan (2203179)">

<title>Visualizing Billion-Dollar Disasters in the USA (1980–2024)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="preparation_files/libs/clipboard/clipboard.min.js"></script>
<script src="preparation_files/libs/quarto-html/quarto.js"></script>
<script src="preparation_files/libs/quarto-html/popper.min.js"></script>
<script src="preparation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="preparation_files/libs/quarto-html/anchor.min.js"></script>
<link href="preparation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="preparation_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="preparation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="preparation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="preparation_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Visualizing Billion-Dollar Disasters in the USA (1980–2024)</h1>
<p class="subtitle lead">Data Preparation</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><u>P4 Team Oldlace</u> <br> Oh Jia Wei Darien (2200607) <br> Peter Febrianto Afandy (2200959) <br> Quek Joo Wee (2201046) <br> Desmond Loy Yong Kiat (2201435) <br> Rene Low Yi Xuan (2202620) <br> Phileo Teo Weihan (2203179) </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This document contains the data engineering required to reconstruct and improve the visualization by <span class="citation" data-cites="dottle_climate_2023">@dottle_climate_2023</span>, shown in <a href="#fig-bb" class="quarto-xref">Figure&nbsp;1</a>, depicting the frequency and estimated costs of Billion-Dollar Disasters (BDDs) in the USA by year, between 1980 and 2024.</p>
<p>The code below requires the following packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"utils.R"</span>) <span class="co"># Custom utility functions and variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-bb" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bb-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/bb_bdd_cropped.png" class="img-fluid figure-img" width="1216">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bb-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Frequency and Estimated Costs of Billion-Dollar Disasters in the USA from 1980 to 2024, by <span class="citation" data-cites="dottle_climate_2023">@dottle_climate_2023</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="dataset" class="level1">
<h1>Dataset</h1>
<p>To conduct analysis on BDDs, two datasets published by the National Centers for Environmental Information (NCEI) of the United States of America were used <a href="#references">(NCEI, 2024)</a>. An additional dataset derived from the NCEI’s <a href="https://www.ncei.noaa.gov/access/billions/state-summary/US">website</a> via web scraping was also used to provide additional contextual information on individual BDD events.</p>
<p>A summary on the three datasets used is provided below:</p>
<ol type="1">
<li><code>events-US-1980-2024.csv</code>: This dataset contains information on BDDs in the USA from 1980 to 2024, organised by each individual event. This dataset was last revised by NCEI on 25 May 2024, and available <a href="https://www.ncei.noaa.gov/archive/archive-management-system/OAS/bin/prd/jquery/accession/download/209268">here</a>.</li>
<li><code>time-series-US-cost-1980-2024.csv</code>: This dataset contains information on BDDs in the USA from 1980 to 2024, organised by year and category. This dataset was last revised by NCEI on 25 May 2024, and available <a href="https://www.ncei.noaa.gov/access/billions/time-series">here</a>.</li>
<li><code>additional-events-US-1980-2024.csv</code>: This dataset was derived from the NCEI’s <a href="https://www.ncei.noaa.gov/access/billions/state-summary/US">website</a>, last updated on 8 May 2024, via web scraping and contains additional information on individual BDD events. It will be combined with the <code>events-US-1980-2024.csv</code> dataset to provide more context on each BDD event.</li>
</ol>
<p>Relevant columns for data processing and analysis on each of the three datasets include:</p>
<ol type="1">
<li><code>events-US-1980-2024.csv</code>
<ul>
<li><code>Name</code>: Name of the disaster event</li>
<li><code>Disaster</code>: Type of disaster that occurred</li>
<li><code>Begin Date</code>: Start date of disaster event (formatted as <code>yyyymmdd</code>)</li>
<li><code>End Date</code>: End date of disaster event (formatted as <code>yyyymmdd</code>)</li>
<li><code>CPI-Adjusted Cost</code>: The cost of the disaster event, adjusted for CPI (Consumer Price Index) over the years</li>
<li><code>Unadjusted Cost</code>: The unadjusted cost of the disaster event</li>
<li><code>Deaths</code>: Number of deaths caused by the disaster event</li>
</ul></li>
<li><code>time-series-US-cost-1980-2024.csv</code>
<ul>
<li><code>State</code>: US State (redundant)</li>
<li><code>Year</code>: Year</li>
<li><code>Drought Count</code>: Total drought events for the year</li>
<li><code>Drought Cost</code>: Total cost of drought events for the year</li>
<li><code>Drought Lower 75</code><sup>1</sup>: Total estimated lower cost of drought events for the year (75% confidence interval probability)</li>
<li><code>Drought Upper 75</code><sup>1</sup>: Total estimated upper cost of drought events for the year (75% confidence interval probability)</li>
<li><code>Drought Lower 90</code><sup>1</sup>: Total estimated lower cost of drought events for the year (90% confidence interval probability)</li>
<li><code>Drought Upper 90</code><sup>1</sup>: Total estimated upper cost of drought events for the year (90% confidence interval probability)</li>
<li><code>Drought Lower 95</code><sup>1</sup>: Total estimated lower cost of drought events for the year (95% confidence interval probability)</li>
<li><code>Drought Upper 95</code><sup>1</sup>: Total estimated upper cost of drought events for the year (95% confidence interval probability)</li>
<li><code>Flooding Count</code>: Total flooding events for the year</li>
<li><code>Flooding Cost</code>: Total cost of flooding events for the year</li>
<li><code>Flooding Lower 75</code><sup>1</sup>: Total estimated lower cost of flooding events for the year (75% confidence interval probability)</li>
<li><code>Flooding Upper 75</code><sup>1</sup>: Total estimated upper cost of flooding events for the year (75% confidence interval probability)</li>
<li><code>Flooding Lower 90</code><sup>1</sup>: Total estimated lower cost of flooding events for the year (90% confidence interval probability)</li>
<li><code>Flooding Upper 90</code><sup>1</sup>: Total estimated upper cost of flooding events for the year (90% confidence interval probability)</li>
<li><code>Flooding Lower 95</code><sup>1</sup>: Total estimated lower cost of flooding events for the year (95% confidence interval probability)</li>
<li><code>Flooding Upper 95</code><sup>1</sup>: Total estimated upper cost of flooding events for the year (95% confidence interval probability)</li>
<li><code>Freeze Count</code>: Total freeze events for the year</li>
<li><code>Freeze Cost</code>: Total cost of freeze events for the year</li>
<li><code>Freeze Lower 75</code><sup>1</sup>: Total estimated lower cost of freeze events for the year (75% confidence interval probability)</li>
<li><code>Freeze Upper 75</code><sup>1</sup>: Total estimated upper cost of freeze events for the year (75% confidence interval probability)</li>
<li><code>Freeze Lower 90</code><sup>1</sup>: Total estimated lower cost of freeze events for the year (90% confidence interval probability)</li>
<li><code>Freeze Upper 90</code><sup>1</sup>: Total estimated upper cost of freeze events for the year (90% confidence interval probability)</li>
<li><code>Freeze Lower 95</code><sup>1</sup>: Total estimated lower cost of freeze events for the year (95% confidence interval probability)</li>
<li><code>Freeze Upper 95</code><sup>1</sup>: Total estimated upper cost of freeze events for the year (95% confidence interval probability)</li>
<li><code>Severe Storm Count</code>: Total severe storm events for the year</li>
<li><code>Severe Storm Cost</code>: Total cost of severe storm events for the year</li>
<li><code>Severe Storm Lower 75</code><sup>1</sup>: Total estimated lower cost of severe storm events for the year (75% confidence interval probability)</li>
<li><code>Severe Storm Upper 75</code><sup>1</sup>: Total estimated upper cost of severe storm events for the year (75% confidence interval probability)</li>
<li><code>Severe Storm Lower 90</code><sup>1</sup>: Total estimated lower cost of severe storm events for the year (90% confidence interval probability)</li>
<li><code>Severe Storm Upper 90</code><sup>1</sup>: Total estimated upper cost of severe storm events for the year (90% confidence interval probability)</li>
<li><code>Severe Storm Lower 95</code><sup>1</sup>: Total estimated lower cost of severe storm events for the year (95% confidence interval probability)</li>
<li><code>Severe Storm Upper 95</code><sup>1</sup>: Total estimated upper cost of severe storm events for the year (95% confidence interval probability)</li>
<li><code>Tropical Cyclone Count</code>: Total tropical cyclone events for the year</li>
<li><code>Tropical Cyclone Cost</code>: Total cost of tropical cyclone events for the year</li>
<li><code>Tropical Cyclone Lower 75</code><sup>1</sup>: Total estimated lower cost of tropical cyclone events for the year (75% confidence interval probability)</li>
<li><code>Tropical Cyclone Upper 75</code><sup>1</sup>: Total estimated upper cost of tropical cyclone events for the year (75% confidence interval probability)</li>
<li><code>Tropical Cyclone Lower 90</code><sup>1</sup>: Total estimated lower cost of tropical cyclone events for the year (90% confidence interval probability)</li>
<li><code>Tropical Cyclone Upper 90</code><sup>1</sup>: Total estimated upper cost of tropical cyclone events for the year (90% confidence interval probability)</li>
<li><code>Tropical Cyclone Lower 95</code><sup>1</sup>: Total estimated lower cost of tropical cyclone events for the year (95% confidence interval probability)</li>
<li><code>Tropical Cyclone Upper 95</code><sup>1</sup>: Total estimated upper cost of tropical cyclone events for the year (95% confidence interval probability)</li>
<li><code>Wildfire Count</code>: Total wildfire events for the year</li>
<li><code>Wildfire Cost</code>: Total cost of wildfire events for the year</li>
<li><code>Wildfire Lower 75</code><sup>1</sup>: Total estimated lower cost of wildfire events for the year (75% confidence interval probability)</li>
<li><code>Wildfire Upper 75</code><sup>1</sup>: Total estimated upper cost of wildfire events for the year (75% confidence interval probability)</li>
<li><code>Wildfire Lower 90</code><sup>1</sup>: Total estimated lower cost of wildfire events for the year (90% confidence interval probability)</li>
<li><code>Wildfire Upper 90</code><sup>1</sup>: Total estimated upper cost of wildfire events for the year (90% confidence interval probability)</li>
<li><code>Wildfire Lower 95</code><sup>1</sup>: Total estimated lower cost of wildfire events for the year (95% confidence interval probability)</li>
<li><code>Wildfire Upper 95</code><sup>1</sup>: Total estimated upper cost of wildfire events for the year (95% confidence interval probability)</li>
<li><code>Winter Storm Count</code>: Total winter storm events for the year</li>
<li><code>Winter Storm Cost</code>: Total cost of winter storm events for the year</li>
<li><code>Winter Storm Lower 75</code><sup>1</sup>: Total estimated lower cost of winter storm events for the year (75% confidence interval probability)</li>
<li><code>Winter Storm Upper 75</code><sup>1</sup>: Total estimated upper cost of winter storm events for the year (75% confidence interval probability)</li>
<li><code>Winter Storm Lower 90</code><sup>1</sup>: Total estimated lower cost of winter storm events for the year (90% confidence interval probability)</li>
<li><code>Winter Storm Upper 90</code><sup>1</sup>: Total estimated upper cost of winter storm events for the year (90% confidence interval probability)</li>
<li><code>Winter Storm Lower 95</code><sup>1</sup>: Total estimated lower cost of winter storm events for the year (95% confidence interval probability)</li>
<li><code>Winter Storm Upper 95</code><sup>1</sup>: Total estimated upper cost of winter storm events for the year (95% confidence interval probability)</li>
<li><code>All Disasters Count</code>: Total disaster events for the year</li>
<li><code>All Disasters Cost</code>: Total cost of all disaster events for the year</li>
<li><code>All Disasters Lower 75</code><sup>1</sup>: Total estimated lower cost of all disaster events for the year (75% confidence interval probability)</li>
<li><code>All Disasters Upper 75</code><sup>1</sup>: Total estimated upper cost of all disaster events for the year (75% confidence interval probability)</li>
<li><code>All Disasters Lower 90</code><sup>1</sup>: Total estimated lower cost of all disaster events for the year (90% confidence interval probability)</li>
<li><code>All Disasters Upper 90</code><sup>1</sup>: Total estimated upper cost of all disaster events for the year (90% confidence interval probability)</li>
<li><code>All Disasters Lower 95</code><sup>1</sup>: Total estimated lower cost of all disaster events for the year (95% confidence interval probability)</li>
<li><code>All Disasters Upper 95</code><sup>1</sup>: Total estimated upper cost of all disaster events for the year (95% confidence interval probability)</li>
</ul></li>
<li><code>additional-events-US-1980-2024.csv</code>
<ul>
<li><code>Name</code>: Name of the disaster event</li>
<li><code>Disaster</code>: Type of disaster that occurred</li>
<li><code>Begin Date</code>: Start date of disaster event (formatted as <code>yyyymmdd</code>)</li>
<li><code>End Date</code>: End date of disaster event (formatted as <code>yyyymmdd</code>)</li>
<li><code>Summary</code>: Description of disaster event</li>
<li><code>CPI-Adjusted Cost</code>: The cost of the disaster event, adjusted for CPI (Consumer Price Index) over the years</li>
<li><code>Unadjusted Cost</code>: The unadjusted cost of the disaster event</li>
<li><code>Deaths</code>: Number of deaths caused by the disaster event</li>
</ul></li>
</ol>
<p><sup>1</sup>Confidence Interval (CI) probabilities represent the uncertainty associated with the particular BDD event’s cost estimate, after Monte Carlo simulations were performed <a href="#references">(Smith &amp; Matthews, 2015)</a>.</p>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory Data Analysis</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load time-series dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>bdd_time_series <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/time-series-US-cost-1980-2024.csv"</span>, <span class="at">skip =</span> <span class="dv">2</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>bdd_time_series</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 45 × 66
   State  Year `Drought Count` `Drought Cost` `Drought Lower 75`
   &lt;chr&gt; &lt;dbl&gt;           &lt;dbl&gt;          &lt;dbl&gt;              &lt;dbl&gt;
 1 US     1980               1           40.2               32.1
 2 US     1981               0            0                  0  
 3 US     1982               0            0                  0  
 4 US     1983               1            9.5                6.7
 5 US     1984               0            0                  0  
 6 US     1985               0            0                  0  
 7 US     1986               1            5.1                4.3
 8 US     1987               0            0                  0  
 9 US     1988               1           54                 41  
10 US     1989               1            7.7                6.7
# ℹ 35 more rows
# ℹ 61 more variables: `Drought Upper 75` &lt;dbl&gt;, `Drought Lower 90` &lt;dbl&gt;,
#   `Drought Upper 90` &lt;dbl&gt;, `Drought Lower 95` &lt;dbl&gt;,
#   `Drought Upper 95` &lt;dbl&gt;, `Flooding Count` &lt;dbl&gt;, `Flooding Cost` &lt;dbl&gt;,
#   `Flooding Lower 75` &lt;dbl&gt;, `Flooding Upper 75` &lt;dbl&gt;,
#   `Flooding Lower 90` &lt;dbl&gt;, `Flooding Upper 90` &lt;dbl&gt;,
#   `Flooding Lower 95` &lt;dbl&gt;, `Flooding Upper 95` &lt;dbl&gt;, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load events dataset</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>bdd_base_events <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/events-US-1980-2024.csv"</span>, <span class="at">skip =</span> <span class="dv">2</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>bdd_base_events</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 383 × 7
   Name   Disaster `Begin Date` `End Date` `CPI-Adjusted Cost` `Unadjusted Cost`
   &lt;chr&gt;  &lt;chr&gt;           &lt;dbl&gt;      &lt;dbl&gt;               &lt;dbl&gt;             &lt;dbl&gt;
 1 South… Flooding     19800410   19800417               2728.              707.
 2 Hurri… Tropica…     19800807   19800811               2213.              590 
 3 Centr… Drought      19800601   19801130              40180.            10020 
 4 Flori… Freeze       19810112   19810114               2054.              572 
 5 Sever… Severe …     19810505   19810510               1397               401.
 6 Midwe… Winter …     19820108   19820116               2191               662 
 7 Midwe… Severe …     19820402   19820404               1590.              483.
 8 Sever… Severe …     19820531   19820610               1564.              480.
 9 Gulf … Flooding     19821201   19830115               4900.             1536.
10 Weste… Flooding     19821213   19830331               4784.             1500.
# ℹ 373 more rows
# ℹ 1 more variable: Deaths &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load additional events dataset</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>bdd_additional_events <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/additional-events-US-1980-2024.csv"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>bdd_additional_events</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 383 × 7
   Name      Disaster `Begin Date` `End Date` Summary `CPI-Adjusted Cost` Deaths
   &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;                 &lt;dbl&gt;  &lt;dbl&gt;
 1 Southern… Severe … 08/04/2024   11/04/2024 Southe…                 1.5      0
 2 Central … Severe … 01/04/2024   03/04/2024 A cent…                 1.8      3
 3 Central … Severe … 13/03/2024   15/03/2024 Damagi…                 4.4      3
 4 Southern… Severe … 10/02/2024   12/02/2024 Severe…                 1.2      0
 5 Central … Winter … 14/01/2024   18/01/2024 A bitt…                 1.3     41
 6 Northwes… Winter … 12/01/2024   15/01/2024 A stro…                 1.1     20
 7 Southern… Severe … 08/01/2024   10/01/2024 Southe…                 2.7      3
 8 East Coa… Flooding 16/12/2023   18/12/2023 Powerf…                 1.3      5
 9 Southern… Drought  01/04/2023   30/09/2023 Drough…                14.6    247
10 Southern… Severe … 23/09/2023   24/09/2023 Hail s…                 1.7      0
# ℹ 373 more rows</code></pre>
</div>
</div>
</section>
<section id="data-cleaning" class="level1">
<h1>Data Cleaning</h1>
<section id="process-time-series-data" class="level2">
<h2 class="anchored" data-anchor-id="process-time-series-data">Process Time Series Data</h2>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">Data Preparation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unwanted columns from the time-series dataset</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>bdd_time_series <span class="ot">&lt;-</span> <span class="fu">select</span>(bdd_time_series, <span class="fu">matches</span>(<span class="st">"^[^0-9]*$"</span>), <span class="sc">-</span><span class="st">`</span><span class="at">State</span><span class="st">`</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>bdd_time_series</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 45 × 17
    Year `Drought Count` `Drought Cost` `Flooding Count` `Flooding Cost`
   &lt;dbl&gt;           &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt;
 1  1980               1           40.2                1             2.7
 2  1981               0            0                  0             0  
 3  1982               0            0                  0             0  
 4  1983               1            9.5                3            10.9
 5  1984               0            0                  0             0  
 6  1985               0            0                  1             4  
 7  1986               1            5.1                1             1.1
 8  1987               0            0                  0             0  
 9  1988               1           54                  0             0  
10  1989               1            7.7                0             0  
# ℹ 35 more rows
# ℹ 12 more variables: `Freeze Count` &lt;dbl&gt;, `Freeze Cost` &lt;dbl&gt;,
#   `Severe Storm Count` &lt;dbl&gt;, `Severe Storm Cost` &lt;dbl&gt;,
#   `Tropical Cyclone Count` &lt;dbl&gt;, `Tropical Cyclone Cost` &lt;dbl&gt;,
#   `Wildfire Count` &lt;dbl&gt;, `Wildfire Cost` &lt;dbl&gt;, `Winter Storm Count` &lt;dbl&gt;,
#   `Winter Storm Cost` &lt;dbl&gt;, `All Disasters Count` &lt;dbl&gt;,
#   `All Disasters Cost` &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="cost-of-billion-dollar-disasters" class="level3">
<h3 class="anchored" data-anchor-id="cost-of-billion-dollar-disasters">Cost of Billion Dollar Disasters</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get cost of BDD events by year</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>bdd_cost <span class="ot">&lt;-</span> bdd_time_series <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"Cost"</span>), <span class="sc">-</span><span class="fu">matches</span>(<span class="st">"All"</span>), Year) <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">" Cost$"</span>, <span class="st">""</span>, .x), <span class="fu">contains</span>(<span class="st">"Cost"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Disaster"</span>, <span class="at">values_to =</span> <span class="st">"Cost"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add disaster subcategory, arrange and sort the dataset</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>bdd_cost <span class="ot">&lt;-</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_disaster_category</span>(bdd_cost) <span class="sc">|&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, Disaster, Category, Cost) <span class="sc">|&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Year, Category, Disaster)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>bdd_cost</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 315 × 4
    Year Disaster         Category            Cost
   &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;              &lt;dbl&gt;
 1  1980 Drought          Dry Weather Events  40.2
 2  1980 Wildfire         Dry Weather Events   0  
 3  1980 Severe Storm     Storm Events         0  
 4  1980 Tropical Cyclone Storm Events         2.2
 5  1980 Flooding         Wet Weather Events   2.7
 6  1980 Freeze           Wet Weather Events   0  
 7  1980 Winter Storm     Wet Weather Events   0  
 8  1981 Drought          Dry Weather Events   0  
 9  1981 Wildfire         Dry Weather Events   0  
10  1981 Severe Storm     Storm Events         1.4
# ℹ 305 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure that there are no missing values or categories</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">verify_data</span>(bdd_cost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Dataframe is error free</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get cost of disaster categories for every 5-year interval</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>bdd_cost_summary <span class="ot">&lt;-</span> bdd_cost <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Interval =</span> <span class="fu">cut</span>(Year, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1980</span>, <span class="fu">max</span>(Year) <span class="sc">+</span> <span class="dv">5</span>, <span class="at">by =</span> <span class="dv">5</span>), <span class="at">right =</span> <span class="cn">FALSE</span>, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Interval =</span> <span class="fu">factor</span>(Interval, <span class="at">levels =</span> <span class="fu">levels</span>(Interval), <span class="at">ordered =</span> <span class="cn">TRUE</span>, <span class="at">labels =</span> <span class="fu">gsub</span>(<span class="st">"2025"</span>, <span class="st">"2024"</span>, <span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"-"</span>, <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">)|</span><span class="sc">\\</span><span class="st">]"</span>, <span class="st">""</span>, <span class="fu">levels</span>(Interval)))))) <span class="sc">|&gt;</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Interval, Category) <span class="sc">|&gt;</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Cost =</span> <span class="fu">sum</span>(Cost, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>bdd_cost_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 3
   Interval  Category            Cost
   &lt;ord&gt;     &lt;chr&gt;              &lt;dbl&gt;
 1 1980-1985 Dry Weather Events  49.7
 2 1980-1985 Storm Events        19.3
 3 1980-1985 Wet Weather Events  24.3
 4 1985-1990 Dry Weather Events  66.8
 5 1985-1990 Storm Events        39.1
 6 1985-1990 Wet Weather Events  18.1
 7 1990-1995 Dry Weather Events  23.4
 8 1990-1995 Storm Events        86.3
 9 1990-1995 Wet Weather Events  84.8
10 1995-2000 Dry Weather Events  17.1
# ℹ 17 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure that there are no missing values or categories</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">verify_data</span>(bdd_cost_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Dataframe is error free</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get aggregated cost of disaster categories for every 5-year interval</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>bdd_cost_aggregated <span class="ot">&lt;-</span> bdd_cost_summary <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Interval) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Cost =</span> <span class="fu">sum</span>(Cost, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Category =</span> <span class="st">"All Events"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Interval, Category, Cost)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>bdd_cost_aggregated</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 3
  Interval  Category    Cost
  &lt;ord&gt;     &lt;chr&gt;      &lt;dbl&gt;
1 1980-1985 All Events  93.3
2 1985-1990 All Events 124  
3 1990-1995 All Events 194. 
4 1995-2000 All Events 137. 
5 2000-2005 All Events 193. 
6 2005-2010 All Events 422. 
7 2010-2015 All Events 332. 
8 2015-2020 All Events 654. 
9 2020-2024 All Events 571. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the aggregated cost with the summary dataset</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># bdd_cost_aggregated &lt;- bdd_cost_aggregated |&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   bind_rows(bdd_cost_summary) |&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(Interval, Category)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># bdd_cost_aggregated</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure that there are no missing values or categories</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">verify_data</span>(bdd_cost_aggregated)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Dataframe is error free</code></pre>
</div>
</div>
</section>
<section id="frequency-of-billion-dollar-disasters" class="level3">
<h3 class="anchored" data-anchor-id="frequency-of-billion-dollar-disasters">Frequency of Billion Dollar Disasters</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get frequency of BDD events by year, and add disaster subcategory</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>bdd_frequency <span class="ot">&lt;-</span> bdd_time_series <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"Count"</span>), <span class="sc">-</span><span class="fu">matches</span>(<span class="st">"All"</span>), Year) <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">" Count$"</span>, <span class="st">""</span>, .x), <span class="fu">contains</span>(<span class="st">"Count"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Disaster"</span>, <span class="at">values_to =</span> <span class="st">"Count"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add disaster subcategory, arrange and sort the dataset</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>bdd_frequency <span class="ot">&lt;-</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_disaster_category</span>(bdd_frequency) <span class="sc">|&gt;</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, Disaster, Category, Count) <span class="sc">|&gt;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Year, Category, Disaster)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>bdd_frequency</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 315 × 4
    Year Disaster         Category           Count
   &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;              &lt;dbl&gt;
 1  1980 Drought          Dry Weather Events     1
 2  1980 Wildfire         Dry Weather Events     0
 3  1980 Severe Storm     Storm Events           0
 4  1980 Tropical Cyclone Storm Events           1
 5  1980 Flooding         Wet Weather Events     1
 6  1980 Freeze           Wet Weather Events     0
 7  1980 Winter Storm     Wet Weather Events     0
 8  1981 Drought          Dry Weather Events     0
 9  1981 Wildfire         Dry Weather Events     0
10  1981 Severe Storm     Storm Events           1
# ℹ 305 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure that there are no missing values or categories</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">verify_data</span>(bdd_frequency)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Dataframe is error free</code></pre>
</div>
</div>
</section>
</section>
<section id="process-events-data" class="level2">
<h2 class="anchored" data-anchor-id="process-events-data">Process Events Data</h2>
<section id="base-events" class="level3">
<h3 class="anchored" data-anchor-id="base-events">Base Events</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert datatype of Begin Date and End Date to dates</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>bdd_base_events <span class="ot">&lt;-</span> bdd_base_events <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ymd</span>(<span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">End Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ymd</span>(<span class="st">`</span><span class="at">End Date</span><span class="st">`</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">format</span>(<span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span>, <span class="st">"%d/%m/%Y"</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">End Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">format</span>(<span class="st">`</span><span class="at">End Date</span><span class="st">`</span>, <span class="st">"%d/%m/%Y"</span>),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">dmy</span>(<span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span>),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">End Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">dmy</span>(<span class="st">`</span><span class="at">End Date</span><span class="st">`</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add disaster subcategory to the base events</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>bdd_base_events <span class="ot">&lt;-</span> <span class="fu">add_disaster_category</span>(bdd_base_events)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>bdd_base_events</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 383 × 8
   Name   Disaster `Begin Date` `End Date` `CPI-Adjusted Cost` `Unadjusted Cost`
   &lt;chr&gt;  &lt;chr&gt;    &lt;date&gt;       &lt;date&gt;                   &lt;dbl&gt;             &lt;dbl&gt;
 1 South… Flooding 1980-04-10   1980-04-17               2728.              707.
 2 Hurri… Tropica… 1980-08-07   1980-08-11               2213.              590 
 3 Centr… Drought  1980-06-01   1980-11-30              40180.            10020 
 4 Flori… Freeze   1981-01-12   1981-01-14               2054.              572 
 5 Sever… Severe … 1981-05-05   1981-05-10               1397               401.
 6 Midwe… Winter … 1982-01-08   1982-01-16               2191               662 
 7 Midwe… Severe … 1982-04-02   1982-04-04               1590.              483.
 8 Sever… Severe … 1982-05-31   1982-06-10               1564.              480.
 9 Gulf … Flooding 1982-12-01   1983-01-15               4900.             1536.
10 Weste… Flooding 1982-12-13   1983-03-31               4784.             1500.
# ℹ 373 more rows
# ℹ 2 more variables: Deaths &lt;dbl&gt;, Category &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="additional-events" class="level3">
<h3 class="anchored" data-anchor-id="additional-events">Additional Events</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert datatype of Begin Date and End Date to dates</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>bdd_additional_events <span class="ot">&lt;-</span> bdd_additional_events <span class="sc">|&gt;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">dmy</span>(<span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span>),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">End Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">dmy</span>(<span class="st">`</span><span class="at">End Date</span><span class="st">`</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span>, <span class="at">format =</span> <span class="st">"%d/%m/%Y"</span>),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">End Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">`</span><span class="at">End Date</span><span class="st">`</span>, <span class="at">format =</span> <span class="st">"%d/%m/%Y"</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add disaster subcategory to the additional events, and select relevant columns</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>bdd_additional_events <span class="ot">&lt;-</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_disaster_category</span>(bdd_additional_events) <span class="sc">|&gt;</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Name, <span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span>, <span class="st">`</span><span class="at">End Date</span><span class="st">`</span>, Category, Summary)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>bdd_additional_events</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 383 × 5
   Name                                 `Begin Date` `End Date` Category Summary
   &lt;chr&gt;                                &lt;date&gt;       &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;  
 1 Southern and Eastern Severe Weather… 2024-04-08   2024-04-11 Storm E… Southe…
 2 Central Tornado Outbreak and Easter… 2024-04-01   2024-04-03 Storm E… A cent…
 3 Central and Southern Severe Weather… 2024-03-13   2024-03-15 Storm E… Damagi…
 4 Southern Severe Weather (February 2… 2024-02-10   2024-02-12 Storm E… Severe…
 5 Central and Southern Winter Storm a… 2024-01-14   2024-01-18 Wet Wea… A bitt…
 6 Northwest Winter Storm (January 202… 2024-01-12   2024-01-15 Wet Wea… A stro…
 7 Southern Tornado Outbreak and East … 2024-01-08   2024-01-10 Storm E… Southe…
 8 East Coast Storm and Flooding (Dece… 2023-12-16   2023-12-18 Wet Wea… Powerf…
 9 Southern/Midwestern Drought and Hea… 2023-04-01   2023-09-30 Dry Wea… Drough…
10 Southern Hail Storms (September 202… 2023-09-23   2023-09-24 Storm E… Hail s…
# ℹ 373 more rows</code></pre>
</div>
</div>
</section>
<section id="combine-events-data" class="level3">
<h3 class="anchored" data-anchor-id="combine-events-data">Combine Events Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine both events and additional events datasets</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>bdd_events <span class="ot">&lt;-</span> bdd_base_events <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    bdd_additional_events,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Name"</span>, <span class="st">"Begin Date"</span>, <span class="st">"End Date"</span>, <span class="st">"Category"</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Name</span><span class="st">`</span>, <span class="st">`</span><span class="at">Disaster</span><span class="st">`</span>, <span class="st">`</span><span class="at">Category</span><span class="st">`</span>, <span class="st">`</span><span class="at">Deaths</span><span class="st">`</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Year</span><span class="st">`</span>, <span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span>, <span class="st">`</span><span class="at">End Date</span><span class="st">`</span>, <span class="st">`</span><span class="at">CPI-Adjusted Cost</span><span class="st">`</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Unadjusted Cost</span><span class="st">`</span>, <span class="st">`</span><span class="at">Summary</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">Year</span><span class="st">`</span>, <span class="st">`</span><span class="at">Begin Date</span><span class="st">`</span>, <span class="st">`</span><span class="at">End Date</span><span class="st">`</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>bdd_events</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 383 × 10
   Name                   Disaster Category Deaths  Year `Begin Date` `End Date`
   &lt;chr&gt;                  &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;       &lt;date&gt;    
 1 Southern Severe Storm… Flooding Wet Wea…      7  1980 1980-04-10   1980-04-17
 2 Central/Eastern Droug… Drought  Dry Wea…   1260  1980 1980-06-01   1980-11-30
 3 Hurricane Allen (Augu… Tropica… Storm E…     13  1980 1980-08-07   1980-08-11
 4 Florida Freeze (Janua… Freeze   Wet Wea…      0  1981 1981-01-12   1981-01-14
 5 Severe Storms, Flash … Severe … Storm E…     20  1981 1981-05-05   1981-05-10
 6 Midwest/Southeast/Nor… Winter … Wet Wea…     85  1982 1982-01-08   1982-01-16
 7 Midwest/Plains/Southe… Severe … Storm E…     33  1982 1982-04-02   1982-04-04
 8 Severe Storms (June 1… Severe … Storm E…     30  1982 1982-05-31   1982-06-10
 9 Gulf States Storms an… Flooding Wet Wea…     45  1982 1982-12-01   1983-01-15
10 Western Storms and Fl… Flooding Wet Wea…     50  1982 1982-12-13   1983-03-31
# ℹ 373 more rows
# ℹ 3 more variables: `CPI-Adjusted Cost` &lt;dbl&gt;, `Unadjusted Cost` &lt;dbl&gt;,
#   Summary &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure that there are no missing values or categories</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">verify_data</span>(bdd_events)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Dataframe is error free</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export combined dataset into CSV</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(bdd_events, <span class="st">"data/combined-events.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="process-combined-events-data" class="level2">
<h2 class="anchored" data-anchor-id="process-combined-events-data">Process Combined Events Data</h2>
<p>Get frequency and estimated cost of BDD events by year, which is equivalent to the <code>bdd_events</code> and <code>bdd_frequency</code> tibbles, but not including categories with values = <code>0</code>. This is to enable cross-checking and data verifications to be performed, to ensure that the values in <code>bdd_events</code> and <code>bdd_frequency</code>, derived from the time series dataset, are accurate and correct.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get frequency and costs of BDD events by year</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>bdd_events_frequency_cost <span class="ot">&lt;-</span> bdd_events <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, Disaster) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Count =</span> <span class="fu">n</span>(),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">CPI-Adjusted Cost</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">CPI-Adjusted Cost</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Unadjusted Cost</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">Unadjusted Cost</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Category =</span> <span class="fu">case_when</span>(</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    Disaster <span class="sc">%in%</span> <span class="fu">names</span>(disaster_mapping) <span class="sc">~</span> disaster_mapping[Disaster],</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Year</span><span class="st">`</span>, <span class="st">`</span><span class="at">Disaster</span><span class="st">`</span>, <span class="st">`</span><span class="at">Category</span><span class="st">`</span>, <span class="st">`</span><span class="at">Count</span><span class="st">`</span>,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">CPI-Adjusted Cost</span><span class="st">`</span>, <span class="st">`</span><span class="at">Unadjusted Cost</span><span class="st">`</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>bdd_events_frequency_cost</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 174 × 6
    Year Disaster         Category   Count `CPI-Adjusted Cost` `Unadjusted Cost`
   &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;      &lt;int&gt;               &lt;dbl&gt;             &lt;dbl&gt;
 1  1980 Drought          Dry Weath…     1              40180.            10020 
 2  1980 Flooding         Wet Weath…     1               2728.              707.
 3  1980 Tropical Cyclone Storm Eve…     1               2213.              590 
 4  1981 Freeze           Wet Weath…     1               2054.              572 
 5  1981 Severe Storm     Storm Eve…     1               1397               401.
 6  1982 Flooding         Wet Weath…     2               9684.             3036.
 7  1982 Severe Storm     Storm Eve…     2               3154.              963.
 8  1982 Winter Storm     Wet Weath…     1               2191               662 
 9  1983 Drought          Dry Weath…     1               9456.             2964.
10  1983 Flooding         Wet Weath…     1               1240               400 
# ℹ 164 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure that there are no missing values or categories</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">verify_data</span>(bdd_events_frequency_cost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Dataframe is error free</code></pre>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>The data are now ready for visualization. The next step will be to create a plot that will allow us to visualise the frequency and estimated costs of Billion-Dollar Disasters in the USA from 1980 to 2024.</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>NOAA National Centers for Environmental Information (NCEI) U.S. Billion-Dollar Weather and Climate Disasters (2024). https://www.ncei.noaa.gov/access/billions/, DOI: <a href="https://www.doi.org/10.25921/stkw-7w73">10.25921/stkw-7w73</a>. Accessed [1 June 2024].</p>
<p>Smith, A., and J. Matthews, 2015: Quantifying Uncertainty and Variable Sensitivity within the U.S. Billion-dollar Weather and Climate Disaster Cost Estimates. Natural Hazards., DOI: <a href="https://link.springer.com/article/10.1007/s11069-015-1678-x">10.1007/s11069-015-1678-x</a>. Accessed [1 June 2024].</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>