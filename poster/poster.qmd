---
title: Visualizing Billion-Dollar Disasters in the USA (1980--2024)
format:
  poster-typst: 
    size: "33x23" # Approximately A1
    poster-authors: "Oh Jia Wei Darien, Peter Febrianto Afandy, Quek Joo Wee, Desmond Loy Yong Kiat, Rene Low Yi Xuan, Phileo Teo Weihan"
    departments: "SIT-UoG Computing Science"
    institution-logo: "images/sit-logo.png"
    footer-text: "CSC3107 Project (Team Oldlace)"
    footer-emails: "2200607, 2200959, 2201046, 2201435, 2202620, 2203179"
execute:
  echo: false
knitr:
  opts_chunk:
    dev: svglite
---

```{r}
#| label: setup
#| include: false

# Execute data preparations and load graphics
library(knitr)
library(scales)
library(ggplot2)
library(dplyr)
library(patchwork)
purl("preparation.qmd")
source("preparation.R")
```

# Introduction

\<some intro and info on disaster relief fund being drained..\>

To highlight the need for enhanced disaster preparedness in the USA, Dottle and Kaufman[^1] presented a combined plot visualizing the total estimated costs by disaster type and the frequency of such events from 1980 to 2023. The plot demonstrated the increased frequency of various types of disasters over the years, likely driven by factors such as climate change, along with their escalating financial impact and costs. Coupled with the depletion of the country's Disaster Relief Fund (DRF), this elucidates the dire need for proactive preparations and mitigations to address the growing threat of such disasters effectively.

[^1]: Dottle, R., & Kaufman, L. (2023). Climate Disasters Drain US Emergency Fund, Adding to Government Shutdown Risk. Retrieved from https://www.bloomberg.com/graphics/2023-fema-disaster-relief-fund-extreme-weather-climate-aid/

# Previous Visualization

```{r}
#| label: fig-bb-on-poster
#| fig-cap: "Frequency and Estimated Costs of Billion-Dollar Disasters in
#| the USA by year, published by Bloomberg."
#| out-width: 100%

include_graphics("images/bb_bdd_cropped.png")
```

# Strengths

-   The graph includes a *dual-axis* representation of the frequency and costs of billion-dollar disasters, providing a comprehensive overview of the data with the use of stacked areas and bars.
-   It includes *annotated descriptions* on certain data points, enhancing the interpretability of the visualisation.
-   The timeline shows *clear trends* over the decades, highlighting the increasing frequency and costs of natural disasters.

# Suggested Improvements

1.  *Split the visualisation into two separate plots* to better highlight the trends in frequency and costs of billion-dollar disasters.
2.  *Enhance the color palette* to improve readability and distinguish between different disaster types.
3.  *Group disaster types* together to provide a clearer overview of the data.

# Implementation

## Data

-   ...
-   ...

## Software

We used the Quarto publication framework and the R programming language, along with the following third-party packages:

-   *tidyverse* for data transformation, including *ggplot2* for visualization based on the grammar of graphics
-   *knitr* for dynamic document generation

# Improved Visualization

## Estimated Costs of Billion-Dollar Disasters in the USA by Year

```{r}
#| label: fig-ggplot
#| fig-width: 10
#| fig-height: 8
#| fig-cap: "Revised visualization of Estimated Costs of Billion-Dollar
#| Disasters in the USA by year."

# Base plot
bdd_category_cost |>
  ggplot(aes(x = Year, y = Cost, color = Category)) +
  geom_line() +
  geom_point() +
  labs(
    x = "Year",
    y = "Cost (CPI-Adjusted, Billion $USD)",
    color = "Disaster Type",
    title = "Estimated Cost of Billion-Dollar Disasters in the USA (1980-2024)",
    caption = "Source: NCEI (2024)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 12),
    legend.title = element_text(size = 12, margin = margin(r = 12)),
    legend.text = element_text(size = 10),
    axis.title = element_text(size = 14),
    axis.title.x = element_text(margin = margin(t = 20)),
    axis.title.y = element_text(margin = margin(r = 20)),
    axis.text = element_text(size = 12),
    legend.position = "top"
  ) +
  # scale_color_brewer(palette = "Paired") +
  scale_x_continuous(breaks = seq(min(bdd_category_cost$Year),
    max(bdd_category_cost$Year + 5),
    by = 5
  )) +
  scale_y_continuous(breaks = seq(0,
    max(bdd_category_cost$Cost + 25),
    by = 25
  ))

# Base plot (cut-off extreme values)
bdd_category_cost |>
  ggplot(aes(x = Year, y = Cost, color = Category)) +
  geom_line() +
  geom_point() +
  labs(
    x = "Year",
    y = "Cost (CPI-Adjusted, Billion $USD)",
    color = "Disaster Type",
    title = "Estimated Cost of Billion-Dollar Disasters in the USA (1980-2024)",
    caption = "Source: NCEI (2024)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 12),
    legend.title = element_text(size = 12, margin = margin(r = 12)),
    legend.text = element_text(size = 10),
    axis.title = element_text(size = 14),
    axis.title.x = element_text(margin = margin(t = 20)),
    axis.title.y = element_text(margin = margin(r = 20)),
    axis.text = element_text(size = 12),
    legend.position = "top"
  ) +
  # scale_color_brewer(palette = "Paired") +
  scale_x_continuous(breaks = seq(min(bdd_category_cost$Year),
    max(bdd_category_cost$Year + 5),
    by = 5
  )) +
  scale_y_continuous(breaks = seq(0,
    max(bdd_category_cost$Cost + 10),
    by = 10
  )) +
  coord_cartesian(xlim = c(1980, 2024), ylim = c(0, 100))

# Grouped values by 5-year intervals
bdd_category_cost_summary |>
  ggplot(aes(x = Year, y = Cost, color = Category)) +
  geom_line(aes(color = Category)) +
  geom_point(aes(color = Category)) +
  labs(
    x = "Year",
    y = "Cost (CPI-Adjusted, Billion $USD)",
    color = "Disaster Type",
    title = "Estimated Cost of Billion-Dollar Disasters in the USA (1980-2024)",
    caption = "Source: NCEI (2024)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 12),
    legend.title = element_text(size = 12, margin = margin(r = 12)),
    legend.text = element_text(size = 10),
    axis.title = element_text(size = 14),
    axis.title.x = element_text(margin = margin(t = 20)),
    axis.title.y = element_text(margin = margin(r = 20)),
    axis.text = element_text(size = 12),
    legend.position = "top"
  ) +
  # scale_color_brewer(palette = "Paired") +
  scale_x_continuous(breaks = seq(min(bdd_category_cost_summary$Year),
    max(bdd_category_cost_summary$Year + 5),
    by = 5
  )) +
  scale_y_continuous(breaks = seq(0,
    max(bdd_category_cost_summary$Cost + 100),
    by = 100
  ))

# Stacked area plot
bdd_category_cost_summary$Category <- factor(bdd_category_cost_summary$Category , levels=c("Storm Events", "Dry Weather Events", "Wet Weather Events"))

bdd_cost_plot <- bdd_category_cost_summary |>
  ggplot(aes(x = Year, y = Cost, fill = Category)) +
  geom_area(position = "stack", alpha = 0.6) +
  labs(
    x = "Year",
    y = "Cost (CPI-Adjusted, Billion $USD)",
    color = "Disaster Type",
    title = "Estimated Cost of Billion-Dollar Disasters in the USA (1980-2024)",
    caption = "Source: NCEI (2024)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 12),
    legend.title = element_text(size = 12, margin = margin(r = 12)),
    legend.text = element_text(size = 10),
    axis.title = element_text(size = 14),
    axis.title.x = element_text(margin = margin(t = 20)),
    axis.title.y = element_text(margin = margin(r = 20)),
    axis.text = element_text(size = 12),
    legend.position = "top"
  ) +
  scale_color_brewer(palette = "Paired") +
  scale_x_continuous(
    breaks = seq(min(bdd_category_cost_summary$Year), max(bdd_category_cost_summary$Year), by = 5),
    minor_breaks = NULL) +
  scale_y_continuous(
    breaks = seq(0, 650, by = 50),
    # limits = c(0, max(bdd_category_cost_summary$Cost) + 25)
  )
bdd_cost_plot
```

## Frequency of Billion-Dollar Disasters in the USA by Year

```{r}
#| label: fig-ggplot2
#| fig-width: 10
#| fig-height: 8
#| fig-cap: "Revised Visualisation of Frequency of Billion-Dollar
#| Disasters in the USA by year."

# Create custom colour palette with distinct shades
custom_palette <- c(
  "Wildfire" = "#fc9e87", # Light red
  "Drought" = "#fb6a4a", # Dark red
  "Freeze" = "#679ad2", # Dark blue
  "Winter Storm" = "#6baed6", # Medium blue
  "Flooding" = "#a6cee3", # Light blue
  "Severe Storm" = "#7DC15A", # Darker yellow (light Green)
  "Tropical Cyclone" = "#C1F2B0", # Darker Green (dark Green)
  "Storm Events" = "#66c2a5", # Darker yellow (light Green)
  "Wet Weather Events" = "#8da0cb", # Darker Green (dark Green)
  "Dry Weather Events" = "#fc8d62" # Dark blue
)

bdd_events_frequency_cost$Disaster <- factor(
  bdd_events_frequency_cost$Disaster,
  levels = c(
    "Wildfire",
    "Drought",
    "Flooding",
    "Winter Storm",
    "Freeze",
    "Tropical Cyclone",
    "Severe Storm"
  )
)

# Create a stacked histogram of the frequency USA from 1980 to 2024
bdd_events_frequency_cost |> ggplot(aes(
  x = Year,
  y = Count,
  fill = Disaster
)) +
  geom_bar(stat = "identity") +
  labs(
    x = "Year",
    y = "Frequency of billion-dollar disaster",
    title = "Frequency of Billion-Dollar Disasters in the USA (1980-2024)",
    caption = "Source: NCEI (2024)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 12),
    legend.title = element_text(size = 12, margin = margin(r = 12)),
    legend.text = element_text(size = 10),
    legend.position = "top",
    axis.title = element_text(size = 14),
    axis.title.x = element_text(margin = margin(t = 20)),
    axis.title.y = element_text(margin = margin(r = 20)),
    axis.text = element_text(size = 12),
    panel.grid.major = element_line(color = "grey", linewidth = 0.5),
    panel.grid.minor = element_blank() # Hide minor grid lines
  ) +
  scale_fill_manual(
    values = custom_palette,
    breaks = c(
      "Severe Storm",
      "Tropical Cyclone",
      "Freeze",
      "Winter Storm",
      "Flooding",
      "Drought",
      "Wildfire"
    ), labels = c(
      "Severe Storm",
      "Tropical Cyclone",
      "Freeze",
      "Winter Storm",
      "Flooding",
      "Drought",
      "Wildfire"
    )
  ) +
  scale_y_continuous(
    breaks = seq(0, 30, by = 3), # Set breaks at intervals of 5
    limits = c(0, 30) # Set Y-axis limits from 0 to 30
  ) +
  guides(
    fill = guide_legend(
      title = "Disaster", # Proper title without causing NULL
      title.position = "left",
      label.position = "right",
      keywidth = unit(1, "lines"), # Set key width to match desired format
      keyheight = unit(1, "lines") # Set key height to match desired format
    )
  )

bdd_events_frequency_cost_summary <- bdd_events_frequency_cost %>%
  mutate(Interval = cut(Year, breaks = seq(1980, 2024, by = 5), right = FALSE)) %>%
  group_by(Interval, Category) %>%
  summarise(Count = sum(Count), .groups = 'drop')

#Sort the categories by total frequency
category_totals <- bdd_events_frequency_cost |>
  group_by(Category) |>
  summarise(Total = sum(Count)) |>
  arrange(Total)

ordered_categories <- category_totals$Category

bdd_events_frequency_cost$Category <- factor(
  bdd_events_frequency_cost$Category,
  levels = ordered_categories
)

# Base plot
bdd_3cat <- 
  bdd_events_frequency_cost |>
  ggplot(aes(x = Year, y = Count, fill = Category)) +
  geom_bar(stat = "identity") +
  labs(
    x = "Year",
    y = "Frequency of billion-dollar disaster",
    title = "Frequency of Billion-Dollar Disasters in the USA (1980-2024)",
    caption = "Source: NCEI (2024)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),
    plot.caption = element_text(size = 12),
    legend.title = element_text(size = 12, margin = margin(r = 12)),
    legend.text = element_text(size = 10),
    legend.position = "top",
    axis.title = element_text(size = 14),
    axis.title.x = element_text(margin = margin(t = 20)),
    axis.title.y = element_text(margin = margin(r = 20)),
    axis.text = element_text(size = 12),
    panel.grid.major = element_line(color = "grey", linewidth = 0.5),
    panel.grid.minor = element_blank() # Hide minor grid lines
  )  +
  scale_y_continuous(
    breaks = seq(0, 30, by = 3), # Set breaks at intervals of 5
    limits = c(0, 30) # Set Y-axis limits from 0 to 30
  ) +
  guides(
    fill = guide_legend(
      title = "Disaster", # Proper title without causing NULL
      title.position = "left",
      label.position = "right",
      keywidth = unit(1, "lines"), # Set key width to match desired format
      keyheight = unit(1, "lines") # Set key height to match desired format
    )
  ) +
  scale_fill_manual(
    values = custom_palette,
    breaks = c(
      "Storm Events",
      "Wet Weather Events",
      "Dry Weather Events"
    ), labels = c(
      "Storm Events",
      "Wet Weather Events",
      "Dry Weather Events"
    )
  )

bdd_3cat

# Flipped, grouped values by 5-year intervals
bdd_events_frequency_cost_summary <- bdd_events_frequency_cost |>
  filter(Category %in% c("Storm Events", "Wet Weather Events", "Dry Weather Events")) |>
  mutate(Interval = cut(Year, breaks = seq(1980, 2025, by = 5), right = FALSE, labels = seq(1980, 2020, by = 5))) |>
  group_by(Interval, Category) |>
  summarise(Count = sum(Count), .groups = 'drop')

five_years_bdd_3cat <- ggplot(bdd_events_frequency_cost_summary, aes(x = Interval, y = Count, fill = Category)) +
  geom_bar(stat = "identity", width = 0.5) +
  labs(
    x = NULL,
    y = "Frequency of billion-dollar disaster",
    title = NULL,
    caption = "Source: NCEI (2024)"
  ) +
  scale_fill_manual(values = custom_palette) +
  theme_minimal() +
  theme(
    text = element_text(size = 12),  # Adjust overall text size
    axis.title.y = element_text(margin = margin(r = 20)),
    panel.grid.major = element_line(color = "grey", linewidth = 0.5),
    panel.grid.minor = element_blank(),  # Hide minor grid lines
    axis.text.x = element_blank(),  # Remove x-axis text
    axis.ticks.x = element_blank()  # Remove x-axis ticks
  ) +
  scale_y_reverse() + 
  guides(fill = FALSE)

five_years_bdd_3cat
```

## Combined Plot of Costs and Frequency

```{r}
combined_plots <- bdd_cost_plot / five_years_bdd_3cat

combined_plots
```

# Further Suggestions for Interactivity

...

# Conclusion

...
